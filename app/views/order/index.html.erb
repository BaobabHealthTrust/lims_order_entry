<style>

    .custom {
        min-width: 300px;
        min-height: 80px;
    }

</style>

<div style="width: 100%; height: 100%; padding: 10px; text-align: center; font-size: 24px;">

  <table width="100%" style="margin-top: 40px;">
    <tr>
      <td rowspan="2" style="width: 100px;">
        <img src="data:image/png;base64,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"
             alt="" onclick="__$('barcode').value = 'P170000000031$';"/>
      </td>
      <td>
        <input type="text" id="barcode" value="" style="width: 80%; border: none; border-bottom: 1px #ccc dotted; font-size: 24px; padding: 10px;"/>
      </td>
    </tr>
    <tr>
      <td>
        Scan Patient Barcode
      </td>
    </tr>
  </table>
    <div>
      <div id="workList" style="width: 95%; border-top: 1px solid #23538a; margin: auto; border: 1px solid #ccc;">

        <table width="100%">
          <caption style="background-color: #ccc">Work List</caption>
          <tr style="background-color: #ccc; color: #333; font-size: 18px;">
            <th style="width: 40%; padding: 5px;">
              Name
            </th>
            <th style="width: 28%; padding: 5px;">
              National ID
            </th>
            <th style=" padding: 5px;">
              Status / Action
            </th>
          </tr>
          <tr>
            <td colspan="4">
              <div id="workListDetails" style="height: 430px; overflow: auto; border: 1px solid #ccc; text-align: center; width: 100%;">
              </div>
            </td>
          </tr>
        </table>

      </div>
    </div>
</div>

<script>

    var url = "/patient/";
    var tmrHnd;
    var timeout = <%= @settings['ward_timeout'] %> *
    60 * 1000;

    function checkBarcode() {

        clearTimeout(tmrHnd);

        __$("barcode").focus();

        if (__$("barcode")) {

            if (__$("barcode").value.trim().match(/[A-Z0-9]+\$/)) {

                showSpinner();

                var barcode = __$("barcode").value.trim().replace(/\$/, "");

                window.location = url + barcode;

                return;

            } else if (__$("barcode").value.trim().match(/\$/)) {

                __$("barcode").value = "";

            }
            timeout -= 100;

        }

        if (__$("btnNext")) {

            __$("btnNext").style.display = "none";
            __$("btnPassChange").style.display = "block";

        }

        if (__$("btnLogout")) {

            __$("btnLogout").innerHTML = "Logout";
            __$("btnLogout").setAttribute("OnMouseDown", "window.location = '/logout'")
            __$("btnLogout").setAttribute("Onclick", "showSpinner(); window.location = '/logout'")

        }

        tmrHnd = setTimeout(function () {
            checkBarcode();
        }, 100);

        if (timeout <= 0) {
            clearTimeout(tmrHnd);
            window.location = '/logout';
        }

    }

    function ajaxTasks(barcode) {

        clearTimeout(timerHnd);

        var url = "/search_by_npid/" + barcode;

        var httpRequest = new XMLHttpRequest();
        httpRequest.onreadystatechange = function () {
            handleTasks(httpRequest);
        };
        try {
            httpRequest.open('GET', url, true);
            httpRequest.send(null);
        } catch (e) {
        }
    }

    function handleTasks(aXMLHttpRequest) {
        if (!aXMLHttpRequest) return;

        if (aXMLHttpRequest.readyState == 4 && (aXMLHttpRequest.status == 200 ||
                aXMLHttpRequest.status == 304)) {

            var result = JSON.parse(aXMLHttpRequest.responseText);

            people = result;

            hideSpinner();
        }
    }

    function pullWorkList()
    {

        var link = "/ward_work_list"
        if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp=new XMLHttpRequest();
        }else{// code for IE6, IE5
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function() {
            if (xmlhttp.readyState==4 && xmlhttp.status==200) {
                var results = xmlhttp.responseText;
                if(results == 'undefined' || results == '' || results == 'null' || results == '"not validate"') {
                    return ;
                }else if(results.length > 0){
                    displayWorkList(JSON.parse(results))
                }else{
                    return ;
                }
            }
        }
        xmlhttp.open("GET",link ,true);
        xmlhttp.send();
    }

    function displayWorkList(list)
    {
        __$("workListDetails").innerHTML = "";

        var table = document.createElement("table");
        table.width = "100%";
        table.style.fontSize = "14px";
        table.setAttribute("id", "workRecords")

        __$("workListDetails").appendChild(table);

        for (i = 0; i < list.length; i++)
        {
            var row = document.createElement("tr");

            table.appendChild(row)

            nameCell = document.createElement("td")
            nameCell.innerHTML = list[i]["patient_name"]
            nameCell.style.width = "40%";
            nameCell.style.textAlign = "left"
            nameCell.style.border = "1px dotted #ccc"
            row.appendChild(nameCell)

            idCell = document.createElement("td")
            idCell.innerHTML= list[i]["national_id"]
            idCell.style.width = "30%";
            idCell.style.border = "1px dotted #ccc"
            idCell.style.textAlign = "left"
            row.appendChild(idCell)

            statusCell = document.createElement("td")

            if (list[i]["status"].toUpperCase().trim() == "VERIFIED")
            {
                var print = document.createElement("img");
                print.src =  printer_red;

                print.height = 50;
                print.setAttribute("state", list[i]["status"]);
                print.setAttribute("accession_number", list[i]["accession_number"]);
                print.setAttribute("test_code", list[i]["test_code"]);
                print.setAttribute("test_name", list[i]["test_type_name"]);
                print.setAttribute("patient_name", list[i]["patient_name"]);
                print.setAttribute("national_id", list[i]["national_id"]);
                print.setAttribute('id', i)
                print.style.cursor = "pointer";
                statusCell.style.textAlign = "center"

                statusCell.appendChild(print)

                print.onclick = function () {

                    getResults(this.getAttribute("accession_number"), this.getAttribute("state"), "Reviewed", this.getAttribute("test_code"), this.getAttribute("test_name"), this.getAttribute('national_id'),this.getAttribute('patient_name'));
                    removeRow(this)
                }
            }
            else
            {
                var view = document.createElement("img");
                view.src =  eye;

                view.height = 50;
                view.setAttribute("state", list[i]["status"]);
                view.setAttribute("accession_number", list[i]["accession_number"]);
                view.setAttribute("test_code", list[i]["test_code"]);
                view.setAttribute("test_name", list[i]["test_type_name"]);
                view.setAttribute("patient_name", list[i]["patient_name"]);
                view.setAttribute("national_id", list[i]["national_id"]);
                view.style.cursor = "pointer";
                statusCell.style.textAlign = "center"

                view.onclick = function() {
                    displayTestState(this.getAttribute('accession_number'), this.getAttribute('state'),this.getAttribute('test_code'), this.getAttribute('test_name'), this.getAttribute('national_id'),this.getAttribute('patient_name'), this);
                }
                statusCell.appendChild(view)
            }

            statusCell.style.border = "1px dotted #ccc"
            row.appendChild(statusCell)
        }
    }

    function removeRow(element) {
        var table = document.getElementById('workRecords');

        table.removeChild(element.parentNode.parentNode)
    }

    function getResults(accession_number, currentState, newState, code, name,national_id,patient_name)
    {
        var url = "/get_labs/"+ national_id;
        showSpinner();
        if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp=new XMLHttpRequest();
        }else{// code for IE6, IE5
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function() {
            if (xmlhttp.readyState==4 && xmlhttp.status==200) {
                var results = xmlhttp.responseText;
                if(results == 'undefined' || results == '' || results == 'null' || results == '"not validate"') {
                    return ;
                }else if(results.length > 0){
                    printResult(accession_number, currentState, newState, code, name,national_id,patient_name,JSON.parse(results))
                    hideSpinner();
                }else{
                    return ;
                }
            }
            hideSpinner();
        }
        xmlhttp.open("GET",url ,true);
        xmlhttp.send();

    }

    pullWorkList()
    checkBarcode();



</script>